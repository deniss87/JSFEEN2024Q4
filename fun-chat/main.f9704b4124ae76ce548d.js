(()=>{"use strict";var t=function(){function t(t,e){this.server="ws://127.0.0.1:4000",this.controller=t,this.view=e}return t.prototype.createConnection=function(){return t=this,e=void 0,r=function(){var t=this;return function(t,e){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){t.socket=new WebSocket(t.server),t.socket.addEventListener("message",(function(e){t.socketResponse(e.data)})),t.socket.addEventListener("open",(function(){t.view.root.classList.remove("view-blur");var n=document.querySelector(".no-connection-container");n&&n.remove(),e("Connnection is opened")})),t.socket.addEventListener("error",(function(t){console.log("Websocket error: ".concat(t))})),t.socket.addEventListener("close",(function(){console.log("no connection to server"),t.view.create("no-connection"),t.reconnect()}))}))];case 1:return[2,e.sent()]}}))},new((n=void 0)||(n=Promise))((function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}c((r=r.apply(t,e||[])).next())}));var t,e,n,r},t.prototype.sendData=function(t){this.socket.send(JSON.stringify(t))},t.prototype.socketResponse=function(t){var e=JSON.parse(t);switch(e.type){case"USER_LOGIN":this.controller.redirect("/");break;case"USER_LOGOUT":sessionStorage.removeItem("user"),sessionStorage.removeItem("password"),this.controller.redirect("/login");break;case"USER_EXTERNAL_LOGIN":this.controller.getActiveUsers(),this.controller.getInactiveUsers(),this.view.create("user-status",[],!0);break;case"USER_EXTERNAL_LOGOUT":this.controller.getActiveUsers(),this.controller.getInactiveUsers(),this.view.create("user-status",[],!1);break;case"USER_ACTIVE":this.view.create("user-list-active",e.payload.users);break;case"USER_INACTIVE":this.view.create("user-list-inactive",e.payload.users);break;case"MSG_SEND":var n=[e.payload.message],r=n[0].to,o=n[0].from;(s=this.view.mainView.activeChat)!==r&&s!==o||this.view.create("user-all-messages",n);break;case"MSG_FROM_USER":this.view.create("user-all-messages",e.payload.messages);break;case"MSG_READ":break;case"MSG_EDIT":(s=this.view.mainView.activeChat)&&this.view.mainView.userChat.updateMessage(e.payload.message);break;case"MSG_DELETE":var s;(s=this.view.mainView.activeChat)&&this.view.mainView.userChat.deleteMessage(e.payload.message.id);break;case"ERROR":if("the user was not authorized"===e.payload.error)sessionStorage.removeItem("user"),this.controller.redirect("/login");else{var i=document.querySelector("#login-pwd-message");i&&(i.textContent=e.payload.error)}break;default:console.log(e)}},t.prototype.reconnect=function(){var t=this,e=setInterval((function(){var n=new WebSocket(t.server);n.addEventListener("open",(function(){console.log("connection restored"),clearInterval(e),t.createConnection(),n.close()}))}),3e3)},t}(),e=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,s=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return i},r=function(){function t(){this.htmlElements=[]}return t.prototype.createElement=function(t,r,o){var s,i,a,c,l=document.createElement(t);try{for(var u=e(Object.entries(o)),h=u.next();!h.done;h=u.next()){var d=n(h.value,2),p=d[0],m=d[1];if("className"===p&&Array.isArray(m))try{for(var f=(a=void 0,e(m)),v=f.next();!v.done;v=f.next()){var y=v.value;l.classList.add(String(y))}}catch(t){a={error:t}}finally{try{v&&!v.done&&(c=f.return)&&c.call(f)}finally{if(a)throw a.error}}else"className"===p&&"string"==typeof m?l.classList.add(String(m)):"text"===p?l.textContent=String(m):"html"===p?l.innerHTML=String(m):"color"===p?l.setAttribute("style","fill: "+String(m)):"event"===p&&Array.isArray(m)?l.addEventListener(m[0],m[1]):l.setAttribute(String(p),String(m))}}catch(t){s={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(s)throw s.error}}return this.htmlElements.push([l,r]),l},t.prototype.mount=function(){var t,n;try{for(var r=e(this.htmlElements),o=r.next();!o.done;o=r.next()){var s=o.value;s[1].append(s[0])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}this.htmlElements=[]},t}();function o(t){return t.length<3?"Length must be more than ".concat(3," characters"):!(t.length>=18)||"Length must not exceed ".concat(18," characters")}function s(t){return t.length<6?"Length must be more than ".concat(6," characters"):t.length>=28?"Length must must not exceed ".concat(28," characters"):!!/[A-Z]/.test(t)||"Use at least one uppercase letter."}var i,a=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return a(e,t),e.prototype.redirect=function(){sessionStorage.getItem("user")&&this.controller.redirect("/")},e.prototype.create=function(){var t=this;this.redirect(),this.mainNode.replaceChildren();var e=this.createElement("main",this.mainNode,{className:"main__login"}),n=this.createElement("div",e,{className:"container__login-header"});this.createElement("h1",n,{className:["text__login-header","text__header-fun"],text:"Fun Chat"});var r=this.createElement("div",e,{className:"container__login-box"}),o=this.createElement("form",r,{className:"form__login"}),s=this.createElement("div",o,{className:"container__login-input"}),i=this.createElement("div",s,{id:"login-name-input",className:"login-input"});this.createElement("label",i,{for:"login-name",text:"Name:"}),this.loginNameInput=this.createElement("input",i,{id:"login-name",className:["input__login-name","input__login"],name:"userName",autofocus:"",minlength:3..toString(),maxlength:18..toString()}),i=this.createElement("div",s,{className:"container__login-message"}),this.createElement("p",i,{id:"login-name-message",className:"text__login-message"});var a=this.createElement("div",o,{className:"container__login-passowrd"});i=this.createElement("div",a,{id:"login-pwd-input",className:"login-input"}),this.createElement("label",i,{for:"login-password",text:"Password:"}),this.loginPwdInput=this.createElement("input",i,{type:"password",id:"login-password",className:["input__login-password","input__login"],name:"userPwd",minlength:6..toString(),maxlength:28..toString()}),i=this.createElement("div",a,{className:"container__login-message"}),this.createElement("p",i,{id:"login-pwd-message",className:"text__login-message"}),i=this.createElement("div",o,{className:"container__login-button"}),this.createElement("button",i,{type:"button",text:"About",className:["button__about","button"],event:["click",function(){t.controller.redirect("/about")}]}),this.createElement("button",i,{type:"button",text:"Login",id:"login-submit-btn",className:["button__login-submit","button"],disabled:"",event:["click",function(){t.controller.loginAuth(t.loginNameInput.value,t.loginPwdInput.value)}]}),this.addEvents(),this.mount()},e.prototype.addEvents=function(){var t=this;this.loginNameInput.addEventListener("input",(function(){t.controller.loginValidation(t.loginNameInput,t.loginNameInput.value)})),this.loginPwdInput.addEventListener("input",(function(){t.controller.loginValidation(t.loginPwdInput,t.loginPwdInput.value)})),document.addEventListener("keydown",(function(e){"Enter"===e.key&&""!==t.loginPwdInput.value&&t.controller.loginAuth(t.loginNameInput.value,t.loginPwdInput.value)}))},e}(r),l=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r.create(),r}return l(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=sessionStorage.getItem("user"),n=this.createElement("div",this.mainNode,{className:"header__user-name"});this.createElement("h3",n,{className:"text__header-user-name",text:"User: ".concat(e)}),n=this.createElement("div",this.mainNode,{className:"header__title"}),this.createElement("h1",n,{className:"text__header-fun",text:"Fun chat"}),n=this.createElement("div",this.mainNode,{className:"header__logout"}),this.createElement("button",n,{className:["button__about","button"],text:"ABOUT",event:["click",function(){t.controller.redirect("/about")}]}),this.createElement("button",n,{className:["button__logout","button"],text:"SIGN OUT",event:["click",function(){t.controller.userLogout()}]}),this.mount()},e}(r),h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r.user=sessionStorage.getItem("user"),r.create(),r}return h(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=this.createElement("div",this.mainNode,{className:["container__user-list"]}),n=this.createElement("div",e,{className:["user-list-search"]}),r=this.createElement("input",n,{type:"search",className:["input__user-list-search"],event:["input",function(){t.userListSearch(r.value)}]});this.userListContainer=this.createElement("div",e,{className:["user-list-names"]}),this.activeUserList=this.createElement("ul",this.userListContainer,{className:["ul__user-list-names"]}),this.inactiveUserList=this.createElement("ul",this.userListContainer,{className:["ul__user-list-names"]}),this.mount()},e.prototype.createActiveUsers=function(t){var e,n,r=this;this.activeUserList.replaceChildren();var o=function(t){if(t.login!==s.user){var e=s.createElement("li",s.activeUserList,{className:["li__user-list","li__user-list-active"],name:t.login,text:t.login,event:["click",function(){r.controller.getChat(t.login,t.isLogined)}]});s.createElement("span",e,{className:"li__user-list-messages"})}},s=this;try{for(var i=d(t),a=i.next();!a.done;a=i.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.mount()},e.prototype.createInactiveUsers=function(t){var e,n,r=this;this.inactiveUserList.replaceChildren();var o=function(t){var e=s.createElement("li",s.inactiveUserList,{className:["li__user-list","li__user-list-inactive"],name:t.login,text:t.login,event:["click",function(){r.controller.getChat(t.login,t.isLogined)}]});s.createElement("span",e,{className:"li__user-list-messages"})},s=this;try{for(var i=d(t),a=i.next();!a.done;a=i.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.mount()},e.prototype.userListSearch=function(t){var e=document.querySelectorAll(".li__user-list"),n=t.trim().toLowerCase();e.forEach((function(t){var e=t.textContent.trim().toLowerCase();t.style.display=e.startsWith(n)?"":"none"}))},e.prototype.showUnreadMessages=function(t){var e,n,r=new Map;try{for(var o=d(t),s=o.next();!s.done;s=o.next()){var i=s.value;if(!i.status.isReaded){var a=r.get(i.from);Number.isNaN(a)&&(a=1),r.set(i.from,a+1)}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},e}(r),m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(e,n,r){var o=t.call(this)||this;return o.controller=e,o.mainNode=n,o.user=r,o.create(),o.addEvents(),o.messageSeparator=!1,o}return m(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=this.createElement("div",this.mainNode,{className:["chat-header"]});this.headerNameElement=this.createElement("div",e,{className:["chat-header-user-name"],text:this.user.name}),this.headerStatusElement=this.createElement("div",e,{className:["chat-header-user-status"],text:this.user.status}),this.chatContainer=this.createElement("div",this.mainNode,{className:["chat-history"]}),e=this.createElement("div",this.mainNode,{className:["chat-input"]}),this.sendInput=this.createElement("input",e,{type:"input",className:["input__user-messages"]}),this.sendButton=this.createElement("button",e,{type:"button",className:["button__user-messages-send"],text:"Send",disabled:"",event:["click",function(){t.sendMessage()}]}),this.contextMenu=this.createElement("div",this.mainNode,{className:["context-menu-container"]}),e=this.createElement("ul",this.contextMenu,{className:["context-menu-list"]}),this.contextMenuEdit=this.createElement("li",e,{className:["context-menu-action","context-menu-action-edit"],text:"EDIT"}),this.contextMenuDelete=this.createElement("li",e,{className:["context-menu-action","context-menu-action-delete"],text:"DELETE"}),this.showUserStatus(),this.mount()},e.prototype.getUserName=function(){return this.user.name},e.prototype.showUserStatus=function(){this.headerStatusElement&&(this.headerStatusElement.textContent=this.user.status?"online":"offline",this.headerStatusElement.style=this.user.status?"color: green":"color: grey")},e.prototype.showSelectUser=function(){var t=this.createElement("div",this.chatContainer,{className:"select-user-container"});this.createElement("h2",t,{className:"text__select-user",text:"Select user"})},e.prototype.showMessages=function(t){var e,n,r=this,o=function(t){var e=t.to===s.user.name?"me":"user",n=new Date(t.datetime),o=n.getHours()+":"+n.getMinutes(),i=s.createElement("div",s.chatContainer,{id:"message-container-".concat(t.id),className:["user-message-container","user-message-container-".concat(e)]}),a=s.createElement("div",i,{className:["user-message-bulb","user-messages-".concat(e)]});s.createElement("div",a,{id:"user-message-".concat(t.id),className:["user-message-text"],text:t.text}),i=s.createElement("div",a,{className:["user-message-status"]}),s.createElement("div",i,{className:["user-message-time"],text:o});var c=s.createElement("div",i,{className:["user-message-menu"],text:"...",event:["click",function(e){e.stopPropagation(),r.showContextMenu(c,t.id)}]});s.controller.setReadStatus(t.id)},s=this;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=i.next();!a.done;a=i.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.mount(),this.chatContainer.scrollTop=this.chatContainer.scrollHeight},e.prototype.showContextMenu=function(t,e){var n=this,r=t.getBoundingClientRect();this.contextMenu.style.top=r.bottom+window.scrollY+"px",this.contextMenu.style.left=r.left+window.scrollX+"px",this.contextMenu.style.display="block",this.contextMenuEdit.addEventListener("click",(function(){var t=document.querySelector("#user-message-".concat(e));t&&(n.sendInput.value=t.textContent),n.messageEditId=e,n.sendInput.setAttribute("editId",e),n.contextMenu.style.display="none"})),this.contextMenuDelete.addEventListener("click",(function(){n.controller.deleteMessage(e),n.contextMenu.style.display="none"}))},e.prototype.sendMessage=function(){var t=this.sendInput.getAttribute("editId");t?(this.controller.editMessage(t,this.sendInput.value),document.querySelector("#user-message-".concat(this.messageEditId)).textContent=this.sendInput.value,this.sendInput.removeAttribute("editId"),this.sendInput.value=""):(this.controller.sendMessage(this.user.name,this.sendInput.value),this.sendInput.value="",this.messageSeparator=!0),this.sendButton.setAttribute("disabled","")},e.prototype.deleteMessage=function(t){var e=document.querySelector("#message-container-".concat(t));e&&e.remove()},e.prototype.updateMessage=function(t){var e=document.querySelector("#user-message-".concat(t.id));e&&(e.textContent=t.text,console.log("updating...",t.id))},e.prototype.addEvents=function(){var t=this;document.addEventListener("click",(function(e){var n=e.target;t.contextMenu.contains(n)||(t.contextMenu.style.display="none")})),document.addEventListener("keydown",(function(e){var n=t.sendInput.value.trim();"Enter"===e.key&&n.length>0&&t.sendMessage()})),this.sendInput.addEventListener("input",(function(){t.sendInput.value.trim().length>0?t.sendButton.removeAttribute("disabled"):t.sendButton.setAttribute("disabled","")}))},e}(r),v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r.create(),r}return v(e,t),e.prototype.create=function(){this.mainNode.replaceChildren(),this.createElement("div",this.mainNode,{className:"footer__school",html:'<a href="https://rs.school/courses/javascript" target="_blank">'.concat('<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="42px" height="42px" viewBox="0 0 64.000000 64.000000"\n preserveAspectRatio="xMidYMid meet">\n<g transform="translate(0.000000,64.000000) scale(0.050000,-0.050000)"\nfill="#000000" stroke="none">\n<path d="M440 1248 c-683 -249 -522 -1240 200 -1237 822 3 852 1212 31 1261\n-99 6 -168 -1 -231 -24z m149 -439 c42 -43 39 -115 -7 -157 -38 -35 -38 -36\n10 -106 62 -92 61 -106 -11 -106 -47 0 -67 15 -103 80 -25 44 -57 80 -72 80\n-17 0 -26 -27 -26 -80 0 -76 -3 -80 -60 -80 l-60 0 0 200 0 200 149 0 c108 0\n157 -8 180 -31z m415 -13 l44 -43 -55 -19 c-43 -14 -64 -10 -93 16 -21 19 -52\n30 -69 23 -58 -22 -31 -50 79 -82 153 -45 188 -115 101 -202 -73 -73 -232 -70\n-306 5 l-54 53 56 19 c46 15 63 11 95 -24 46 -49 84 -53 116 -15 30 36 -2 62\n-113 92 -193 51 -151 221 55 221 76 0 110 -10 144 -44z"/>\n<path d="M394 767 c-35 -35 -13 -87 37 -87 43 0 90 48 66 68 -19 18 -91 31\n-103 19z"/>\n</g>\n</svg>',"</a>")}),this.createElement("div",this.mainNode,{className:"footer__author",html:"&copy; Deniss Patancevs (2025)"}),this.createElement("div",this.mainNode,{className:"footer__year",html:'<a href="https://github.com/deepcd87" target="_blank">'.concat('<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 72 72" width="64px" height="64px"><path d="M36,12c13.255,0,24,10.745,24,24c0,10.656-6.948,19.685-16.559,22.818c0.003-0.009,0.007-0.022,0.007-0.022\ts-1.62-0.759-1.586-2.114c0.038-1.491,0-4.971,0-6.248c0-2.193-1.388-3.747-1.388-3.747s10.884,0.122,10.884-11.491\tc0-4.481-2.342-6.812-2.342-6.812s1.23-4.784-0.426-6.812c-1.856-0.2-5.18,1.774-6.6,2.697c0,0-2.25-0.922-5.991-0.922\tc-3.742,0-5.991,0.922-5.991,0.922c-1.419-0.922-4.744-2.897-6.6-2.697c-1.656,2.029-0.426,6.812-0.426,6.812\ts-2.342,2.332-2.342,6.812c0,11.613,10.884,11.491,10.884,11.491s-1.097,1.239-1.336,3.061c-0.76,0.258-1.877,0.576-2.78,0.576\tc-2.362,0-4.159-2.296-4.817-3.358c-0.649-1.048-1.98-1.927-3.221-1.927c-0.817,0-1.216,0.409-1.216,0.876s1.146,0.793,1.902,1.659\tc1.594,1.826,1.565,5.933,7.245,5.933c0.617,0,1.876-0.152,2.823-0.279c-0.006,1.293-0.007,2.657,0.013,3.454\tc0.034,1.355-1.586,2.114-1.586,2.114s0.004,0.013,0.007,0.022C18.948,55.685,12,46.656,12,36C12,22.745,22.745,12,36,12z"/></svg>',"</a>")}),this.mount()},e}(r),g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return g(e,t),e.prototype.create=function(){this.reloginUser(),this.mainNode.replaceChildren();var t=this.createElement("header",this.mainNode,{className:"header"});new u(this.controller,t),this.mainContainer=this.createElement("main",this.mainNode,{className:"main"}),this.userList=new p(this.controller,this.mainContainer),this.chatContainer=this.createElement("div",this.mainContainer,{className:["container__chat"]}),this.createNoUserSelected();var e=this.createElement("footer",this.mainNode,{className:"footer"});new y(this.controller,e),this.mount(),this.getData()},e.prototype.getData=function(){this.controller.getActiveUsers(),this.controller.getInactiveUsers()},e.prototype.createNoUserSelected=function(){var t=this.createElement("div",this.chatContainer,{className:"select-user-container"});this.createElement("h2",t,{className:["text__select-user","text__info-italic"],text:"select user for chat"})},e.prototype.createChat=function(t){this.userChat=new f(this.controller,this.chatContainer,t),this.activeChat=t.name},e.prototype.updateUserStatus=function(t){this.userChat&&(this.userChat.user.status=t,this.userChat.showUserStatus())},e.prototype.showAllMessages=function(t){this.userChat?this.userChat.showMessages(t):console.log("open chat to see new message")},e.prototype.reloginUser=function(){sessionStorage.getItem("user")&&this.controller.reloginUser()},e}(r),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return w(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=this.createElement("main",this.mainNode,{className:"main-about"}),n=this.createElement("div",e,{className:"about-header"});this.createElement("h1",n,{className:["text__about-header","text__header-fun"],text:"What is Fun Chat?"}),n=this.createElement("div",e,{className:["about-main","text__standart"],html:'\n    <h3>Fan Chat is a simple messaging app created as part of the RS School course.</h3>\n    <p>You can log in by entering any name and password, if they meet the authorization requirements.</p>\n    <p>In the future, use the same data to access your messages.</p>\n    <p>Communicate easily with your friends and family and of course...</p>\n    <h2 class="text__header-fun">HAVE FUN</h2>\n    '}),n=this.createElement("div",e,{className:"about-button"}),this.createElement("button",n,{className:["button__about-back","button"],text:"BACK",event:["click",function(){t.controller.redirect("/")}]}),this.mount()},e}(r),E=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return E(e,t),e.prototype.create=function(){var t=this.createElement("div",document.body,{className:"no-connection-container"});this.createElement("h1",t,{className:"text__no-connection-header",text:"NO CONNECTION"}),this.mainNode.classList.add("view-blur"),this.mount()},e}(r),x=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),S=function(t){function e(e){var n=t.call(this)||this;return n.controller=e,n.root=n.createElement("div",document.body,{id:"root"}),n.loginView=new c(n.controller,n.root),n.mainView=new _(n.controller,n.root),n.aboutView=new b(n.controller,n.root),n.NoConnectionView=new N(n.controller,n.root),n.mount(),n}return x(e,t),e.prototype.create=function(t,e,n){switch(t){case"login":this.loginView.create();break;case"main":this.mainView.create();break;case"about":this.aboutView.create();break;case"user-list-active":this.mainView.userList.createActiveUsers(e);break;case"user-list-inactive":this.mainView.userList.createInactiveUsers(e);break;case"user-status":this.mainView.updateUserStatus(n);break;case"user-list-messages":this.mainView.userList.showUnreadMessages(e);break;case"user-all-messages":this.mainView.showAllMessages(e);break;case"no-connection":this.NoConnectionView.create()}},e}(r),I=function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}c((r=r.apply(t,e||[])).next())}))},C=function(t,e){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};new(function(){function e(e){this.getSession(),this.view=new S(this),this.model=new t(this,this.view),this.router=e}return e.prototype.getSession=function(){var t=sessionStorage.getItem("funID");void 0===t?this.setSession(24):(this.sessionId=t,this.userName=sessionStorage.getItem("user"),this.userPassword=sessionStorage.getItem("password"))},e.prototype.setSession=function(t){var e=new Uint8Array(t);crypto.getRandomValues(e);var n=Array.from(e,(function(t){return t.toString(16).padStart(2,"0")})).join("");return sessionStorage.setItem("funID",n),n},e.prototype.redirect=function(t){globalThis.history.pushState(t,"Fun Chat","/deepcd87-JSFEEN2024Q4/fun-chat/"+t),this.getView()},e.prototype.loginValidation=function(t,e){var n=document.querySelector("#login-name-message"),r=document.querySelector("#login-pwd-message"),i=document.querySelector("#login-submit-btn");if("userName"===t.name){var a=o(e);!0===a?(t.classList.remove("input__incorrect"),t.classList.add("input__correct"),n.textContent="",this.nameValidation=!0):(t.classList.remove("input__correct"),t.classList.add("input__incorrect"),n.textContent=a.toString(),this.nameValidation=!1)}if("userPwd"===t.name){var c=s(e);!0===c?(t.classList.remove("input__incorrect"),t.classList.add("input__correct"),r.textContent="",this.pwdValidation=!0):(t.classList.remove("input__correct"),t.classList.add("input__incorrect"),r.textContent=c.toString(),this.pwdValidation=!1)}this.nameValidation&&this.pwdValidation?i.removeAttribute("disabled"):i.setAttribute("disabled","")},e.prototype.loginAuth=function(t,e){return I(this,void 0,void 0,(function(){var n,r,i;return C(this,(function(a){return n=o(t),r=s(e),!0===n&&!0===r?(i={id:this.sessionId,type:"USER_LOGIN",payload:{user:{login:t,password:e}}},sessionStorage.setItem("user",t),sessionStorage.setItem("password",e),this.userName=t,this.userPassword=e,this.model.sendData(i)):console.log("LOGIN AUTHENTICATION ERROR"),[2]}))}))},e.prototype.reloginUser=function(){var t={id:this.sessionId,type:"USER_LOGIN",payload:{user:{login:this.userName,password:this.userPassword}}};this.model.sendData(t)},e.prototype.userLogout=function(){var t={id:this.sessionId,type:"USER_LOGOUT",payload:{user:{login:this.userName,password:this.userPassword}}};this.model.sendData(t)},e.prototype.getViewAuth=function(t){if(!1===t.auth)return!0;var e=sessionStorage.getItem("user");return!(!0!==t.auth||!e)},e.prototype.getActiveUsers=function(){var t={id:this.sessionId,type:"USER_ACTIVE",payload:{}};this.model.sendData(t)},e.prototype.getInactiveUsers=function(){var t={id:this.sessionId,type:"USER_INACTIVE",payload:{}};this.model.sendData(t)},e.prototype.getChat=function(t,e){var n={name:t,status:e};this.view.mainView.createChat(n),this.getAllMessages(t)},e.prototype.sendMessage=function(t,e){var n={id:this.sessionId,type:"MSG_SEND",payload:{message:{to:t,text:e}}};this.model.sendData(n)},e.prototype.editMessage=function(t,e){var n={id:this.sessionId,type:"MSG_EDIT",payload:{message:{id:t,text:e}}};this.model.sendData(n)},e.prototype.deleteMessage=function(t){var e={id:this.sessionId,type:"MSG_DELETE",payload:{message:{id:t}}};this.model.sendData(e)},e.prototype.getAllMessages=function(t){var e={id:this.sessionId,type:"MSG_FROM_USER",payload:{user:{login:t}}};this.model.sendData(e)},e.prototype.setReadStatus=function(t){var e={id:this.sessionId,type:"MSG_READ",payload:{message:{id:t}}};this.model.sendData(e)},e.prototype.getUnreadMessages=function(t){var e={id:this.sessionId,type:"MSG_FROM_USER",payload:{user:{login:t}}};this.model.sendData(e)},e.prototype.getView=function(){var t=this.router.resolve();if(!t)throw new Error("Not found");this.getViewAuth(t)?this.view.create(t.view):this.redirect("/login")},e.prototype.start=function(){return I(this,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return console.log("App is running..."),[4,this.model.createConnection()];case 1:return t.sent(),this.getView(),[2]}}))}))},e}())(new(function(){function t(t){this.registeredRoutes=t}return t.prototype.resolve=function(){this.result=void 0,this.url=globalThis.location.href,this.urlParts=this.url.split("/"),this.uri="/"+this.urlParts[3];for(var t=0;t<this.registeredRoutes.length;t+=1)if(this.uri===this.registeredRoutes[t].uri)return this.result=this.registeredRoutes[t],this.result;if(this.result)return this.result;console.log("Route not found")},t}())([{uri:"/",view:"main",auth:!0},{uri:"/login",view:"login",auth:!1},{uri:"/about",view:"about",auth:!1}])).start()})();