(()=>{"use strict";var t=function(){function t(t,e){this.server="ws://127.0.0.1:4000",this.controller=t,this.view=e}return t.prototype.createConnection=function(){return t=this,e=void 0,r=function(){var t=this;return function(t,e){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e){t.socket=new WebSocket(t.server),t.socket.addEventListener("message",(function(e){t.socketResponse(e.data)})),t.socket.addEventListener("open",(function(){e("Connnection is opened")}))}))];case 1:return[2,e.sent()]}}))},new((n=void 0)||(n=Promise))((function(o,s){function i(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}l((r=r.apply(t,e||[])).next())}));var t,e,n,r},t.prototype.sendData=function(t){this.socket.send(JSON.stringify(t))},t.prototype.socketResponse=function(t){var e=JSON.parse(t);switch(e.type){case"USER_LOGIN":globalThis.history.pushState("/","Fun Chat","/deepcd87-JSFEEN2024Q4/fun-chat"),this.controller.getView();break;case"USER_LOGOUT":sessionStorage.removeItem("user"),sessionStorage.removeItem("password"),globalThis.history.pushState("/login","Fun Chat","/deepcd87-JSFEEN2024Q4/fun-chat/login"),this.controller.getView();break;case"USER_EXTERNAL_LOGIN":this.controller.getActiveUsers(),this.controller.getInactiveUsers(),this.view.create("user-status",[],!0);break;case"USER_EXTERNAL_LOGOUT":this.controller.getActiveUsers(),this.controller.getInactiveUsers(),this.view.create("user-status",[],!1);break;case"USER_ACTIVE":this.view.create("user-list-active",e.payload.users);break;case"USER_INACTIVE":this.view.create("user-list-inactive",e.payload.users);break;case"MSG_SEND":var n=[e.payload.message];this.view.create("user-all-messages",n);break;case"MSG_FROM_USER":this.view.create("user-all-messages",e.payload.messages);break;case"MSG_EDIT":case"MSG_DELETE":var r;(r=this.view.mainView.userChat.user.name)&&this.controller.getAllMessages(r);break;case"ERROR":if(console.log(e.payload.error),"the user was not authorized"===e.payload.error)sessionStorage.removeItem("user"),globalThis.history.pushState("/login","Fun Chat","/deepcd87-JSFEEN2024Q4/fun-chat/login"),this.controller.getView();else{var o=document.querySelector("#login-pwd-message");o&&(o.textContent=e.payload.error)}break;default:console.log(e)}},t}(),e=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},n=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,s=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return i},r=function(){function t(){this.htmlElements=[]}return t.prototype.createElement=function(t,r,o){var s,i,a,l,c=document.createElement(t);try{for(var u=e(Object.entries(o)),h=u.next();!h.done;h=u.next()){var p=n(h.value,2),d=p[0],m=p[1];if("className"===d&&Array.isArray(m))try{for(var f=(a=void 0,e(m)),y=f.next();!y.done;y=f.next()){var v=y.value;c.classList.add(String(v))}}catch(t){a={error:t}}finally{try{y&&!y.done&&(l=f.return)&&l.call(f)}finally{if(a)throw a.error}}else"className"===d&&"string"==typeof m?c.classList.add(String(m)):"text"===d?c.textContent=String(m):"html"===d?c.innerHTML=String(m):"color"===d?c.setAttribute("style","fill: "+String(m)):"event"===d&&Array.isArray(m)?c.addEventListener(m[0],m[1]):c.setAttribute(String(d),String(m))}}catch(t){s={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(s)throw s.error}}return this.htmlElements.push([c,r]),c},t.prototype.mount=function(){var t,n;try{for(var r=e(this.htmlElements),o=r.next();!o.done;o=r.next()){var s=o.value;s[1].append(s[0])}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}this.htmlElements=[]},t}();function o(t){return t.length<3?"Length must be more than ".concat(3," characters"):!(t.length>=18)||"Length must not exceed ".concat(18," characters")}function s(t){return t.length<6?"Length must be more than ".concat(6," characters"):t.length>=28?"Length must must not exceed ".concat(28," characters"):!!/[A-Z]/.test(t)||"Use at least one uppercase letter."}var i,a=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),l=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return a(e,t),e.prototype.redirect=function(){sessionStorage.getItem("auth")&&(globalThis.location.href="/")},e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=this.createElement("section",this.mainNode,{id:"main",className:"section__main-login"}),n=this.createElement("div",e,{className:"container__login-box"}),r=this.createElement("form",n,{className:"form__login"}),o=this.createElement("div",r,{className:"container__login-input"}),s=this.createElement("div",o,{id:"login-name-input",className:"login-input"});this.createElement("label",s,{for:"login-name-input",text:"Name:"}),this.loginNameInput=this.createElement("input",s,{id:"login-name",className:["input__login-name","input__login"],name:"userName",autofocus:"",minlength:3..toString(),maxlength:18..toString()}),s=this.createElement("div",o,{className:"container__login-message"}),this.createElement("p",s,{id:"login-name-message",className:"text__login-message"});var i=this.createElement("div",r,{className:"container__login-passowrd"});s=this.createElement("div",i,{id:"login-pwd-input",className:"login-input"}),this.createElement("label",s,{for:"login-password",text:"Password:"}),this.loginPwdInput=this.createElement("input",s,{type:"password",id:"login-password",className:["input__login-password","input__login"],name:"userPwd",minlength:6..toString(),maxlength:28..toString()}),s=this.createElement("div",i,{className:"container__login-message"}),this.createElement("p",s,{id:"login-pwd-message",className:"text__login-message"}),s=this.createElement("div",r,{className:"container__login-button"}),this.createElement("button",s,{type:"button",text:"Login",id:"login-submit-btn",className:"button__login-submit",disabled:"",event:["click",function(){t.controller.loginAuth(t.loginNameInput.value,t.loginPwdInput.value)}]}),this.addEvents(),this.mount()},e.prototype.addEvents=function(){var t=this;this.loginNameInput.addEventListener("input",(function(){t.controller.loginValidation(t.loginNameInput,t.loginNameInput.value)})),this.loginPwdInput.addEventListener("input",(function(){t.controller.loginValidation(t.loginPwdInput,t.loginPwdInput.value)})),document.addEventListener("keydown",(function(e){"Enter"===e.key&&""!==t.loginPwdInput.value&&t.controller.loginAuth(t.loginNameInput.value,t.loginPwdInput.value)}))},e}(r),c=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r.create(),r}return c(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=sessionStorage.getItem("user"),n=this.createElement("div",this.mainNode,{className:"header__user-name"});this.createElement("h3",n,{className:"text__header-user-name",text:"User: ".concat(e)}),n=this.createElement("div",this.mainNode,{className:"header__title"}),this.createElement("h3",n,{className:"text__header-title",text:"Fun chat"}),n=this.createElement("div",this.mainNode,{className:"header__logout"}),this.createElement("button",n,{className:"button__logout",text:"Logout",event:["click",function(){t.controller.userLogout()}]}),this.mount()},e}(r),h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),p=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},d=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r.user=sessionStorage.getItem("user"),r.create(),r}return h(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=this.createElement("div",this.mainNode,{className:["container__user-list"]}),n=this.createElement("div",e,{className:["user-list-search"]}),r=this.createElement("input",n,{type:"search",className:["input__user-list-search"],event:["input",function(){t.userListSearch(r.value)}]});this.userListContainer=this.createElement("div",e,{className:["user-list-names"]}),this.activeUserList=this.createElement("ul",this.userListContainer,{className:["ul__user-list-names"]}),this.inactiveUserList=this.createElement("ul",this.userListContainer,{className:["ul__user-list-names"]}),this.mount()},e.prototype.createActiveUsers=function(t){var e,n,r=this;this.activeUserList.replaceChildren();var o=function(t){if(t.login!==s.user){var e=s.createElement("li",s.activeUserList,{className:["li__user-list","li__user-list-active"],name:t.login,text:t.login,event:["click",function(){r.controller.getChat(t.login,t.isLogined)}]});s.createElement("span",e,{className:"li__user-list-messages"})}},s=this;try{for(var i=p(t),a=i.next();!a.done;a=i.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.mount()},e.prototype.createInactiveUsers=function(t){var e,n,r=this;this.inactiveUserList.replaceChildren();var o=function(t){var e=s.createElement("li",s.inactiveUserList,{className:["li__user-list","li__user-list-inactive"],name:t.login,text:t.login,event:["click",function(){r.controller.getChat(t.login,t.isLogined)}]});s.createElement("span",e,{className:"li__user-list-messages"})},s=this;try{for(var i=p(t),a=i.next();!a.done;a=i.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.mount()},e.prototype.userListSearch=function(t){var e=document.querySelectorAll(".li__user-list"),n=t.trim().toLowerCase();e.forEach((function(t){var e=t.textContent.trim().toLowerCase();t.style.display=e.startsWith(n)?"":"none"}))},e.prototype.showUnreadMessages=function(t){var e,n,r=new Map;try{for(var o=p(t),s=o.next();!s.done;s=o.next()){var i=s.value;if(!i.status.isReaded){var a=r.get(i.from);Number.isNaN(a)&&(a=1),r.set(i.from,a+1)}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}console.log(r)},e}(r),m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(e,n,r){var o=t.call(this)||this;return o.controller=e,o.mainNode=n,o.user=r,o.create(),o.addEvents(),o}return m(e,t),e.prototype.create=function(){var t=this;this.mainNode.replaceChildren();var e=this.createElement("div",this.mainNode,{className:["chat-header"]});this.headerNameElement=this.createElement("div",e,{className:["chat-header-user-name"],text:this.user.name}),this.headerStatusElement=this.createElement("div",e,{className:["chat-header-user-status"],text:this.user.status}),this.chatContainer=this.createElement("div",this.mainNode,{className:["chat-history"]}),e=this.createElement("div",this.mainNode,{className:["chat-input"]}),this.sendInput=this.createElement("input",e,{type:"input",className:["input__user-messages"]}),this.sendButton=this.createElement("button",e,{type:"button",className:["button__user-messages-send"],text:"Send",disabled:"",event:["click",function(){t.sendMessage()}]}),this.contextMenu=this.createElement("div",this.chatContainer,{className:["context-menu-container"]}),e=this.createElement("ul",this.contextMenu,{className:["context-menu-list"]}),this.contextMenuEdit=this.createElement("li",e,{className:["context-menu-action"],text:"EDIT"}),this.contextMenuDelete=this.createElement("li",e,{className:["context-menu-action"],text:"DELETE"}),this.showUserStatus(),this.mount()},e.prototype.getUserName=function(){return this.user.name},e.prototype.showUserStatus=function(){this.headerStatusElement&&(this.headerStatusElement.textContent=this.user.status?"online":"offline",this.headerStatusElement.style=this.user.status?"color: green":"color: grey")},e.prototype.showMessages=function(t){var e,n,r=this,o=function(t){var e=t.to===s.user.name?"me":"user",n=new Date(t.datetime),o=n.getHours()+":"+n.getMinutes(),i=s.createElement("div",s.chatContainer,{className:["user-message-container","user-message-container-".concat(e)]}),a=s.createElement("div",i,{className:["user-message-bulb","user-messages-".concat(e)]});s.createElement("div",a,{className:["user-message-text"],text:t.text}),i=s.createElement("div",a,{className:["user-message-status"]}),s.createElement("div",i,{className:["user-message-time"],text:o});var l=s.createElement("div",i,{className:["user-message-menu"],text:"...",event:["click",function(e){e.stopPropagation(),r.showContextMenu(l,t.id,t.text)}]})},s=this;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=i.next();!a.done;a=i.next())o(a.value)}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}this.mount(),this.chatContainer.scrollTop=this.chatContainer.scrollHeight},e.prototype.showContextMenu=function(t,e,n){var r=this,o=t.getBoundingClientRect();this.contextMenu.style.top=o.bottom+window.scrollY+"px",this.contextMenu.style.left=o.left+window.scrollX+"px",this.contextMenu.style.display="block",this.contextMenuEdit.addEventListener("click",(function(){r.sendInput.value=n,r.sendInput.setAttribute("editId",e),r.contextMenu.style.display="none"})),this.contextMenuDelete.addEventListener("click",(function(){r.controller.deleteMessage(e),r.contextMenu.style.display="none"}))},e.prototype.sendMessage=function(){var t=this.sendInput.getAttribute("editId");t?(this.controller.editMessage(t,this.sendInput.value),this.sendInput.removeAttribute("editId"),this.sendInput.value=""):(this.controller.sendMessage(this.user.name,this.sendInput.value),this.sendInput.value=""),this.sendButton.setAttribute("disabled","")},e.prototype.addEvents=function(){var t=this;document.addEventListener("click",(function(e){var n=e.target;t.contextMenu.contains(n)||(t.contextMenu.style.display="none")})),document.addEventListener("keydown",(function(e){var n=t.sendInput.value.trim();"Enter"===e.key&&n.length>0&&t.sendMessage()})),this.sendInput.addEventListener("input",(function(){t.sendInput.value.trim().length>0?t.sendButton.removeAttribute("disabled"):t.sendButton.setAttribute("disabled","")}))},e}(r),y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),v=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r.create(),r}return y(e,t),e.prototype.create=function(){this.mainNode.replaceChildren(),this.createElement("div",this.mainNode,{className:"footer__school",html:"RSSchool"}),this.createElement("div",this.mainNode,{className:"footer__author",html:"&copy; Deniss Patancevs"}),this.createElement("div",this.mainNode,{className:"footer__year",html:"2025"}),this.mount()},e}(r),g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return g(e,t),e.prototype.create=function(t){console.log(t),this.mainNode.replaceChildren();var e=this.createElement("header",this.mainNode,{className:"header"});new u(this.controller,e);var n=this.createElement("main",this.mainNode,{className:"main"});this.mainContainer=this.createElement("div",n,{className:"container__main"}),this.userList=new d(this.controller,this.mainContainer),this.chatContainer=this.createElement("div",this.mainContainer,{className:["container__chat"]});var r=this.createElement("footer",this.mainNode,{className:"footer"});new v(this.controller,r),this.mount(),this.getData()},e.prototype.getData=function(){this.controller.getActiveUsers(),this.controller.getInactiveUsers()},e.prototype.createChat=function(t){this.userChat=new f(this.controller,this.chatContainer,t)},e.prototype.updateUserStatus=function(t){this.userChat&&(this.userChat.user.status=t,this.userChat.showUserStatus())},e.prototype.showAllMessages=function(t){this.userChat?this.userChat.showMessages(t):console.log("open chat to see new message")},e}(r),w=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(t){function e(e,n){var r=t.call(this)||this;return r.controller=e,r.mainNode=n,r}return w(e,t),e.prototype.create=function(){this.mainNode.replaceChildren();var t=this.createElement("main",this.mainNode,{className:"main"});this.createElement("h1",t,{className:"text",text:"About"}),this.mount()},e}(r),E=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(t){function e(e){var n=t.call(this)||this;return n.controller=e,n.root=n.createElement("div",document.body,{id:"root"}),n.loginView=new l(n.controller,n.root),n.mainView=new _(n.controller,n.root),n.aboutView=new b(n.controller,n.root),n.mount(),n}return E(e,t),e.prototype.create=function(t,e,n){switch(t){case"login":this.loginView.create();break;case"main":this.mainView.create(e);break;case"about":this.aboutView.create();break;case"user-list-active":this.mainView.userList.createActiveUsers(e);break;case"user-list-inactive":this.mainView.userList.createInactiveUsers(e);break;case"user-status":this.mainView.updateUserStatus(n);break;case"user-list-messages":this.mainView.userList.showUnreadMessages(e);break;case"user-all-messages":this.mainView.showAllMessages(e)}},e}(r),S=function(t,e,n,r){return new(n||(n=Promise))((function(o,s){function i(t){try{l(r.next(t))}catch(t){s(t)}}function a(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}l((r=r.apply(t,e||[])).next())}))},x=function(t,e){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};new(function(){function e(e){this.view=new N(this),this.model=new t(this,this.view),this.router=e,this.getSession()}return e.prototype.getSession=function(){var t=sessionStorage.getItem("id");t?(this.sessionId=t,this.userName=sessionStorage.getItem("user"),this.userPassword=sessionStorage.getItem("password")):this.setSession(24)},e.prototype.setSession=function(t){var e=new Uint8Array(t);crypto.getRandomValues(e);var n=Array.from(e,(function(t){return t.toString(16).padStart(2,"0")})).join("");return sessionStorage.setItem("id",n),n},e.prototype.loginValidation=function(t,e){var n=document.querySelector("#login-name-message"),r=document.querySelector("#login-pwd-message"),i=document.querySelector("#login-submit-btn");if("userName"===t.name){var a=o(e);!0===a?(t.classList.remove("input__incorrect"),t.classList.add("input__correct"),n.textContent="",this.nameValidation=!0):(t.classList.remove("input__correct"),t.classList.add("input__incorrect"),n.textContent=a.toString(),this.nameValidation=!1)}if("userPwd"===t.name){var l=s(e);!0===l?(t.classList.remove("input__incorrect"),t.classList.add("input__correct"),r.textContent="",this.pwdValidation=!0):(t.classList.remove("input__correct"),t.classList.add("input__incorrect"),r.textContent=l.toString(),this.pwdValidation=!1)}this.nameValidation&&this.pwdValidation?i.removeAttribute("disabled"):i.setAttribute("disabled","")},e.prototype.loginAuth=function(t,e){return S(this,void 0,void 0,(function(){var n,r,i;return x(this,(function(a){return n=o(t),r=s(e),!0===n&&!0===r?(i={id:this.sessionId,type:"USER_LOGIN",payload:{user:{login:t,password:e}}},sessionStorage.setItem("user",t),sessionStorage.setItem("password",e),this.userName=t,this.userPassword=e,this.model.sendData(i)):console.log(n,r),[2]}))}))},e.prototype.reloginUser=function(){var t={id:this.sessionId,type:"USER_LOGIN",payload:{user:{login:this.userName,password:this.userPassword}}};this.model.sendData(t)},e.prototype.userLogout=function(){var t={id:this.sessionId,type:"USER_LOGOUT",payload:{user:{login:this.userName,password:this.userPassword}}};console.log(t),this.model.sendData(t)},e.prototype.getViewAuth=function(t){if(!1===t.auth)return!0;var e=sessionStorage.getItem("user");return!(!0!==t.auth||!e)},e.prototype.getActiveUsers=function(){var t={id:this.sessionId,type:"USER_ACTIVE",payload:{}};this.model.sendData(t)},e.prototype.getInactiveUsers=function(){var t={id:this.sessionId,type:"USER_INACTIVE",payload:{}};this.model.sendData(t)},e.prototype.getChat=function(t,e){var n={name:t,status:e};this.view.mainView.createChat(n),this.getAllMessages(t)},e.prototype.sendMessage=function(t,e){var n={id:this.sessionId,type:"MSG_SEND",payload:{message:{to:t,text:e}}};this.model.sendData(n)},e.prototype.editMessage=function(t,e){var n={id:this.sessionId,type:"MSG_EDIT",payload:{message:{id:t,text:e}}};this.model.sendData(n)},e.prototype.deleteMessage=function(t){var e={id:this.sessionId,type:"MSG_DELETE",payload:{message:{id:t}}};this.model.sendData(e)},e.prototype.getAllMessages=function(t){var e={id:this.sessionId,type:"MSG_FROM_USER",payload:{user:{login:t}}};this.model.sendData(e)},e.prototype.getUnreadMessages=function(t){var e={id:this.sessionId,type:"MSG_FROM_USER",payload:{user:{login:t}}};this.model.sendData(e)},e.prototype.getView=function(){var t=this.router.resolve();if(!t)throw new Error("Not found");this.getViewAuth(t)?this.view.create(t.view):globalThis.location.href="login"},e.prototype.start=function(){return S(this,void 0,void 0,(function(){return x(this,(function(t){switch(t.label){case 0:return console.log("App is running..."),[4,this.model.createConnection()];case 1:return t.sent(),sessionStorage.getItem("user")&&this.reloginUser(),this.getView(),[2]}}))}))},e}())(new(function(){function t(t){this.registeredRoutes=t}return t.prototype.resolve=function(){this.result=void 0,this.url=globalThis.location.href,this.urlParts=this.url.split("/"),this.uri="/"+this.urlParts[5];for(var t=0;t<this.registeredRoutes.length;t+=1)if(this.uri===this.registeredRoutes[t].uri)return this.result=this.registeredRoutes[t],this.result;if(this.result)return this.result;console.log("Route not found")},t}())([{uri:"/",view:"main",auth:!0},{uri:"/login",view:"login",auth:!1},{uri:"/about",view:"about",auth:!1}])).start()})();