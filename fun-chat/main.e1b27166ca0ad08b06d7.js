(()=>{"use strict";var e=function(){function e(e,t){this.server="ws://127.0.0.1:4000",this.controller=e,this.view=t}return e.prototype.createConnection=function(){return e=this,t=void 0,r=function(){var e=this;return function(e,t){var n,r,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(s=2&a[0]?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;switch(r=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t){e.socket=new WebSocket(e.server),e.socket.addEventListener("message",(function(t){e.socketResponse(t.data)})),e.socket.addEventListener("open",(function(){e.view.root.classList.remove("view-blur");var n=document.querySelector(".no-connection-container");n&&n.remove(),e.controller.userName&&e.controller.userPassword&&e.controller.reloginUser(),t("Connnection is opened")})),e.socket.addEventListener("error",(function(e){console.log("Websocket error: ".concat(e))})),e.socket.addEventListener("close",(function(){console.log("no connection to server"),e.view.create("no-connection"),e.reconnect()}))}))];case 1:return[2,t.sent()]}}))},new((n=void 0)||(n=Promise))((function(s,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}));var e,t,n,r},e.prototype.sendData=function(e){this.socket.send(JSON.stringify(e))},e.prototype.socketResponse=function(e){var t=JSON.parse(e);switch(t.type){case"USER_LOGIN":this.controller.redirect("/");break;case"USER_LOGOUT":sessionStorage.removeItem("user"),sessionStorage.removeItem("password"),this.controller.redirect("/login");break;case"USER_EXTERNAL_LOGIN":this.controller.getActiveUsers(),this.controller.getInactiveUsers(),this.view.create("user-status",[],!0);break;case"USER_EXTERNAL_LOGOUT":this.controller.getActiveUsers(),this.controller.getInactiveUsers(),this.view.create("user-status",[],!1);break;case"USER_ACTIVE":this.view.create("user-list-active",t.payload.users);break;case"USER_INACTIVE":this.view.create("user-list-inactive",t.payload.users);break;case"MSG_SEND":var n=[t.payload.message],r=n[0].to,s=n[0].from;(o=this.view.mainView.activeChat)!==r&&o!==s||this.view.create("user-all-messages",n);break;case"MSG_FROM_USER":this.view.create("user-all-messages",t.payload.messages);break;case"MSG_READ":(o=this.view.mainView.activeChat)&&this.view.mainView.userChat.updateMessageStatus(t.payload.message);break;case"MSG_EDIT":(o=this.view.mainView.activeChat)&&this.view.mainView.userChat.updateMessage(t.payload.message);break;case"MSG_DELETE":var o;(o=this.view.mainView.activeChat)&&this.view.mainView.userChat.deleteMessage(t.payload.message.id);break;case"ERROR":if("the user was not authorized"===t.payload.error)sessionStorage.removeItem("user"),this.controller.redirect("/login");else{var i=document.querySelector("#login-pwd-message");i&&(i.textContent=t.payload.error)}break;default:console.log(t)}},e.prototype.reconnect=function(){var e=this,t=setInterval((function(){var n=new WebSocket(e.server);n.addEventListener("open",(function(){console.log("connection restored"),clearInterval(t),e.createConnection(),n.close()}))}),3e3)},e}(),t=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},n=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,o=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)i.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(s)throw s.error}}return i},r=function(){function e(){this.htmlElements=[]}return e.prototype.createElement=function(e,r,s){var o,i,a,c,l=document.createElement(e);try{for(var u=t(Object.entries(s)),h=u.next();!h.done;h=u.next()){var d=n(h.value,2),p=d[0],m=d[1];if("className"===p&&Array.isArray(m))try{for(var f=(a=void 0,t(m)),v=f.next();!v.done;v=f.next()){var g=v.value;l.classList.add(String(g))}}catch(e){a={error:e}}finally{try{v&&!v.done&&(c=f.return)&&c.call(f)}finally{if(a)throw a.error}}else"className"===p&&"string"==typeof m?l.classList.add(String(m)):"text"===p?l.textContent=String(m):"html"===p?l.innerHTML=String(m):"color"===p?l.setAttribute("style","fill: "+String(m)):"event"===p&&Array.isArray(m)?l.addEventListener(m[0],m[1]):l.setAttribute(String(p),String(m))}}catch(e){o={error:e}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}return this.htmlElements.push([l,r]),l},e.prototype.mount=function(){var e,n;try{for(var r=t(this.htmlElements),s=r.next();!s.done;s=r.next()){var o=s.value;o[1].append(o[0])}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}this.htmlElements=[]},e}();function s(e){return e.length<3?"Length must be more than ".concat(3," characters"):!(e.length>=18)||"Length must not exceed ".concat(18," characters")}function o(e){return e.length<6?"Length must be more than ".concat(6," characters"):e.length>=28?"Length must must not exceed ".concat(28," characters"):!!/[A-Z]/.test(e)||"Use at least one uppercase letter."}var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),c=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r}return a(t,e),t.prototype.redirect=function(){sessionStorage.getItem("user")&&this.controller.redirect("/")},t.prototype.create=function(){var e=this;this.redirect(),this.mainNode.replaceChildren();var t=this.createElement("main",this.mainNode,{className:"main__login"}),n=this.createElement("div",t,{className:"container__login-header"});this.createElement("h1",n,{className:["text__login-header","text__header-fun"],text:"Fun Chat"});var r=this.createElement("div",t,{className:"container__login-box"}),s=this.createElement("form",r,{className:"form__login"}),o=this.createElement("div",s,{className:"container__login-input"}),i=this.createElement("div",o,{id:"login-name-input",className:"login-input"});this.createElement("label",i,{for:"login-name",text:"Name:"}),this.loginNameInput=this.createElement("input",i,{id:"login-name",className:["input__login-name","input__login"],name:"userName",autofocus:"",minlength:3..toString(),maxlength:18..toString()}),i=this.createElement("div",o,{className:"container__login-message"}),this.createElement("p",i,{id:"login-name-message",className:"text__login-message"});var a=this.createElement("div",s,{className:"container__login-passowrd"});i=this.createElement("div",a,{id:"login-pwd-input",className:"login-input"}),this.createElement("label",i,{for:"login-password",text:"Password:"}),this.loginPwdInput=this.createElement("input",i,{type:"password",id:"login-password",className:["input__login-password","input__login"],name:"userPwd",minlength:6..toString(),maxlength:28..toString()}),i=this.createElement("div",a,{className:"container__login-message"}),this.createElement("p",i,{id:"login-pwd-message",className:"text__login-message"}),i=this.createElement("div",s,{className:"container__login-button"}),this.createElement("button",i,{type:"button",text:"About",className:["button__about","button"],event:["click",function(){e.controller.redirect("/about")}]}),this.createElement("button",i,{type:"button",text:"Login",id:"login-submit-btn",className:["button__login-submit","button"],disabled:"",event:["click",function(){e.controller.loginAuth(e.loginNameInput.value,e.loginPwdInput.value)}]}),this.addEvents(),this.mount()},t.prototype.addEvents=function(){var e=this;this.loginNameInput.addEventListener("input",(function(){e.controller.loginValidation(e.loginNameInput,e.loginNameInput.value)})),this.loginPwdInput.addEventListener("input",(function(){e.controller.loginValidation(e.loginPwdInput,e.loginPwdInput.value)})),document.addEventListener("keydown",(function(t){"Enter"===t.key&&""!==e.loginPwdInput.value&&e.controller.loginAuth(e.loginNameInput.value,e.loginPwdInput.value)}))},t}(r),l=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),u=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r.create(),r}return l(t,e),t.prototype.create=function(){var e=this;this.mainNode.replaceChildren();var t=sessionStorage.getItem("user"),n=this.createElement("div",this.mainNode,{className:"header__user-name"});this.createElement("h3",n,{className:"text__header-user-name",text:"User: ".concat(t)}),n=this.createElement("div",this.mainNode,{className:"header__title"}),this.createElement("h1",n,{className:"text__header-fun",text:"Fun chat"}),n=this.createElement("div",this.mainNode,{className:"header__logout"}),this.createElement("button",n,{className:["button__about","button"],text:"ABOUT",event:["click",function(){e.controller.redirect("/about")}]}),this.createElement("button",n,{className:["button__logout","button"],text:"SIGN OUT",event:["click",function(){e.controller.userLogout()}]}),this.mount()},t}(r),h=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r.user=sessionStorage.getItem("user"),r.create(),r}return h(t,e),t.prototype.create=function(){var e=this;this.mainNode.replaceChildren();var t=this.createElement("div",this.mainNode,{className:["container__user-list"]}),n=this.createElement("div",t,{className:["user-list-search"]}),r=this.createElement("input",n,{type:"search",className:["input__user-list-search"],event:["input",function(){e.userListSearch(r.value)}]});this.userListContainer=this.createElement("div",t,{className:["user-list-names"]}),this.activeUserList=this.createElement("ul",this.userListContainer,{className:["ul__user-list-names"]}),this.inactiveUserList=this.createElement("ul",this.userListContainer,{className:["ul__user-list-names"]}),this.mount()},t.prototype.createActiveUsers=function(e){var t,n,r=this;this.activeUserList.replaceChildren();var s=function(e){if(e.login!==o.user){var t=o.createElement("li",o.activeUserList,{className:["li__user-list","li__user-list-active"],name:e.login,text:e.login,event:["click",function(){r.controller.getChat(e.login,e.isLogined)}]});o.createElement("span",t,{className:"li__user-list-messages"})}},o=this;try{for(var i=d(e),a=i.next();!a.done;a=i.next())s(a.value)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.mount()},t.prototype.createInactiveUsers=function(e){var t,n,r=this;this.inactiveUserList.replaceChildren();var s=function(e){var t=o.createElement("li",o.inactiveUserList,{className:["li__user-list","li__user-list-inactive"],name:e.login,text:e.login,event:["click",function(){r.controller.getChat(e.login,e.isLogined)}]});o.createElement("span",t,{className:"li__user-list-messages"})},o=this;try{for(var i=d(e),a=i.next();!a.done;a=i.next())s(a.value)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.mount()},t.prototype.userListSearch=function(e){var t=document.querySelectorAll(".li__user-list"),n=e.trim().toLowerCase();t.forEach((function(e){var t=e.textContent.trim().toLowerCase();e.style.display=t.startsWith(n)?"":"none"}))},t.prototype.showUnreadMessages=function(e){var t,n,r=new Map;try{for(var s=d(e),o=s.next();!o.done;o=s.next()){var i=o.value;if(!i.status.isReaded){var a=r.get(i.from);Number.isNaN(a)&&(a=1),r.set(i.from,a+1)}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}},t}(r);function m(e,t,n){var r="";return n&&(r="message-status-".concat(e)),'<svg id="message-status-'.concat(e,"-").concat(t,'" class="message-status ').concat(r,'" width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <g id="Interface / Check">\n  <path id="Vector" d="M6 12L10.2426 16.2426L18.727 7.75732" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n  </g>\n  </svg>')}var f=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),v=function(e){function t(t,n,r){var s=e.call(this)||this;return s.controller=t,s.mainNode=n,s.user=r,s.create(),s.addEvents(),s.messageSeparator=!1,s}return f(t,e),t.prototype.create=function(){var e=this;this.mainNode.replaceChildren();var t=this.createElement("div",this.mainNode,{className:["chat-header"]});this.headerNameElement=this.createElement("div",t,{className:["chat-header-user-name"],text:this.user.name}),this.headerStatusElement=this.createElement("div",t,{className:["chat-header-user-status"],text:this.user.status}),this.chatContainer=this.createElement("div",this.mainNode,{className:["chat-history"]}),t=this.createElement("div",this.mainNode,{className:["chat-input"]}),this.sendInput=this.createElement("input",t,{type:"input",className:["input__user-messages"],autofocus:""}),this.sendButton=this.createElement("button",t,{type:"button",className:["button__user-messages-send"],text:"Send",disabled:"",event:["click",function(){e.sendMessage()}]}),this.contextMenu=this.createElement("div",this.mainNode,{className:["context-menu-container"]}),t=this.createElement("ul",this.contextMenu,{className:["context-menu-list"]}),this.contextMenuEdit=this.createElement("li",t,{className:["context-menu-action","context-menu-action-edit"],text:"EDIT"}),this.contextMenuDelete=this.createElement("li",t,{className:["context-menu-action","context-menu-action-delete"],text:"DELETE"}),this.showUserStatus(),this.mount()},t.prototype.getUserName=function(){return this.user.name},t.prototype.showUserStatus=function(){this.headerStatusElement&&(this.headerStatusElement.textContent=this.user.status?"online":"offline",this.headerStatusElement.style=this.user.status?"color: green":"color: grey")},t.prototype.showSelectUser=function(){var e=this.createElement("div",this.chatContainer,{className:"select-user-container"});this.createElement("h2",e,{className:"text__select-user",text:"Select user"})},t.prototype.showMessages=function(e){var t,n,r=this,s=function(e){var t=e.to===o.user.name?"me":"user",n=new Date(e.datetime),s=n.getHours()+":"+n.getMinutes(),i="",a="";e.status.isDelivered&&(i="delivered"),e.status.isReaded&&(a="readed");var c=o.createElement("div",o.chatContainer,{id:"message-container-".concat(e.id),className:["user-message-container","user-message-container-".concat(t)]}),l=o.createElement("div",c,{className:["user-message-bulb","user-messages-".concat(t)]});o.createElement("div",l,{id:"user-message-".concat(e.id),className:["user-message-text"],text:e.text});var u=o.createElement("div",l,{className:["user-message-info-container"]});if(o.createElement("div",u,{className:["user-message-time"],text:s}),c=o.createElement("div",u,{className:"user-message-status-container"}),o.createElement("div",c,{className:["user-message-status-delivered"],title:i,html:m("delivered",e.id,e.status.isDelivered)}),o.createElement("div",c,{className:["user-message-status-read"],title:a,html:m("read",e.id,e.status.isReaded)}),e.from!==o.user.name)var h=o.createElement("div",u,{className:["user-message-menu"],html:'<svg width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M18.3785 8.44975L8.9636 17.8648C8.6844 18.144 8.3288 18.3343 7.94161 18.4117L4.99988 19.0001L5.58823 16.0583C5.66566 15.6711 5.85597 15.3155 6.13517 15.0363L15.5501 5.62132M18.3785 8.44975L19.7927 7.03553C20.1832 6.64501 20.1832 6.01184 19.7927 5.62132L18.3785 4.20711C17.988 3.81658 17.3548 3.81658 16.9643 4.20711L15.5501 5.62132M18.3785 8.44975L15.5501 5.62132" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',event:["click",function(t){t.stopPropagation(),r.showContextMenu(h,e.id)}]});a||o.controller.setReadStatus(e.id)},o=this;try{for(var i=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),a=i.next();!a.done;a=i.next())s(a.value)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.mount(),this.chatContainer.scrollTop=this.chatContainer.scrollHeight},t.prototype.showContextMenu=function(e,t){var n=this,r=e.getBoundingClientRect();this.contextMenu.style.top=r.bottom+window.scrollY+"px",this.contextMenu.style.left=r.left+window.scrollX+"px",this.contextMenu.style.display="block",this.contextMenuEdit.addEventListener("click",(function(){var e=document.querySelector("#user-message-".concat(t));e&&(n.sendInput.value=e.textContent,n.sendInput.focus()),n.messageEditId=t,n.sendInput.setAttribute("editId",t),n.contextMenu.style.display="none"})),this.contextMenuDelete.addEventListener("click",(function(){n.controller.deleteMessage(t),n.contextMenu.style.display="none"}))},t.prototype.sendMessage=function(){var e=this.sendInput.getAttribute("editId");e?(this.controller.editMessage(e,this.sendInput.value),document.querySelector("#user-message-".concat(this.messageEditId)).textContent=this.sendInput.value,this.sendInput.removeAttribute("editId"),this.sendInput.value=""):(this.controller.sendMessage(this.user.name,this.sendInput.value),this.sendInput.value="",this.messageSeparator=!0),this.sendButton.setAttribute("disabled","")},t.prototype.deleteMessage=function(e){var t=document.querySelector("#message-container-".concat(e));t&&t.remove()},t.prototype.updateMessage=function(e){var t=document.querySelector("#user-message-".concat(e.id));t&&(t.textContent=e.text)},t.prototype.updateMessageStatus=function(e){if(e.status.isReaded){var t=document.querySelector("#message-status-read-".concat(e.id));t&&(t.classList.add("message-status-read"),t.parentElement.setAttribute("title","readed"))}},t.prototype.addEvents=function(){var e=this;document.addEventListener("click",(function(t){var n=t.target;e.contextMenu.contains(n)||(e.contextMenu.style.display="none")})),document.addEventListener("keydown",(function(t){var n=e.sendInput.value.trim();"Enter"===t.key&&n.length>0&&e.sendMessage()})),this.sendInput.addEventListener("input",(function(){e.sendInput.value.trim().length>0?e.sendButton.removeAttribute("disabled"):e.sendButton.setAttribute("disabled","")}))},t}(r),g=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r.create(),r}return g(t,e),t.prototype.create=function(){this.mainNode.replaceChildren(),this.createElement("div",this.mainNode,{className:"footer__school",html:'<a href="https://rs.school/courses/javascript" target="_blank">'.concat('<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="42px" height="42px" viewBox="0 0 64.000000 64.000000"\n preserveAspectRatio="xMidYMid meet">\n<g transform="translate(0.000000,64.000000) scale(0.050000,-0.050000)"\nfill="#000000" stroke="none">\n<path d="M440 1248 c-683 -249 -522 -1240 200 -1237 822 3 852 1212 31 1261\n-99 6 -168 -1 -231 -24z m149 -439 c42 -43 39 -115 -7 -157 -38 -35 -38 -36\n10 -106 62 -92 61 -106 -11 -106 -47 0 -67 15 -103 80 -25 44 -57 80 -72 80\n-17 0 -26 -27 -26 -80 0 -76 -3 -80 -60 -80 l-60 0 0 200 0 200 149 0 c108 0\n157 -8 180 -31z m415 -13 l44 -43 -55 -19 c-43 -14 -64 -10 -93 16 -21 19 -52\n30 -69 23 -58 -22 -31 -50 79 -82 153 -45 188 -115 101 -202 -73 -73 -232 -70\n-306 5 l-54 53 56 19 c46 15 63 11 95 -24 46 -49 84 -53 116 -15 30 36 -2 62\n-113 92 -193 51 -151 221 55 221 76 0 110 -10 144 -44z"/>\n<path d="M394 767 c-35 -35 -13 -87 37 -87 43 0 90 48 66 68 -19 18 -91 31\n-103 19z"/>\n</g>\n</svg>',"</a>")}),this.createElement("div",this.mainNode,{className:"footer__author",html:"&copy; Deniss Patancevs (2025)"}),this.createElement("div",this.mainNode,{className:"footer__year",html:'<a href="https://github.com/deepcd87" target="_blank">'.concat('<svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 72 72" width="64px" height="64px"><path d="M36,12c13.255,0,24,10.745,24,24c0,10.656-6.948,19.685-16.559,22.818c0.003-0.009,0.007-0.022,0.007-0.022\ts-1.62-0.759-1.586-2.114c0.038-1.491,0-4.971,0-6.248c0-2.193-1.388-3.747-1.388-3.747s10.884,0.122,10.884-11.491\tc0-4.481-2.342-6.812-2.342-6.812s1.23-4.784-0.426-6.812c-1.856-0.2-5.18,1.774-6.6,2.697c0,0-2.25-0.922-5.991-0.922\tc-3.742,0-5.991,0.922-5.991,0.922c-1.419-0.922-4.744-2.897-6.6-2.697c-1.656,2.029-0.426,6.812-0.426,6.812\ts-2.342,2.332-2.342,6.812c0,11.613,10.884,11.491,10.884,11.491s-1.097,1.239-1.336,3.061c-0.76,0.258-1.877,0.576-2.78,0.576\tc-2.362,0-4.159-2.296-4.817-3.358c-0.649-1.048-1.98-1.927-3.221-1.927c-0.817,0-1.216,0.409-1.216,0.876s1.146,0.793,1.902,1.659\tc1.594,1.826,1.565,5.933,7.245,5.933c0.617,0,1.876-0.152,2.823-0.279c-0.006,1.293-0.007,2.657,0.013,3.454\tc0.034,1.355-1.586,2.114-1.586,2.114s0.004,0.013,0.007,0.022C18.948,55.685,12,46.656,12,36C12,22.745,22.745,12,36,12z"/></svg>',"</a>")}),this.mount()},t}(r),w=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r}return w(t,e),t.prototype.create=function(){this.reloginUser(),this.mainNode.replaceChildren();var e=this.createElement("header",this.mainNode,{className:"header"});new u(this.controller,e),this.mainContainer=this.createElement("main",this.mainNode,{className:"main"}),this.userList=new p(this.controller,this.mainContainer),this.chatContainer=this.createElement("div",this.mainContainer,{className:["container__chat"]}),this.createNoUserSelected();var t=this.createElement("footer",this.mainNode,{className:"footer"});new y(this.controller,t),this.mount(),this.getData()},t.prototype.getData=function(){this.controller.getActiveUsers(),this.controller.getInactiveUsers()},t.prototype.createNoUserSelected=function(){var e=this.createElement("div",this.chatContainer,{className:"select-user-container"});this.createElement("h2",e,{className:["text__select-user","text__info-italic"],text:"select user for chat"})},t.prototype.createChat=function(e){this.userChat=new v(this.controller,this.chatContainer,e),this.activeChat=e.name},t.prototype.updateUserStatus=function(e){this.userChat&&(this.userChat.user.status=e,this.userChat.showUserStatus())},t.prototype.showAllMessages=function(e){this.userChat?this.userChat.showMessages(e):console.log("open chat to see new message")},t.prototype.reloginUser=function(){sessionStorage.getItem("user")&&this.controller.reloginUser()},t}(r),b=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),E=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r}return b(t,e),t.prototype.create=function(){var e=this;this.mainNode.replaceChildren();var t=this.createElement("main",this.mainNode,{className:"main-about"}),n=this.createElement("div",t,{className:"about-header"});this.createElement("h1",n,{className:["text__about-header","text__header-fun"],text:"What is Fun Chat?"}),n=this.createElement("div",t,{className:["about-main","text__standart"],html:'\n    <h3>Fan Chat is a simple messaging app created as part of the RS School course.</h3>\n    <p>You can log in by entering any name and password, if they meet the authorization requirements.</p>\n    <p>In the future, use the same data to access your messages.</p>\n    <p>Communicate easily with your friends and family and of course...</p>\n    <h2 class="text__header-fun">HAVE FUN</h2>\n    '}),n=this.createElement("div",t,{className:"about-button"}),this.createElement("button",n,{className:["button__about-back","button"],text:"BACK",event:["click",function(){e.controller.redirect("/")}]}),this.mount()},t}(r),N=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),x=function(e){function t(t,n){var r=e.call(this)||this;return r.controller=t,r.mainNode=n,r}return N(t,e),t.prototype.create=function(){var e=this.createElement("div",document.body,{className:"no-connection-container"});this.createElement("h1",e,{className:"text__no-connection-header",text:"NO CONNECTION"}),this.mainNode.classList.add("view-blur"),this.mount()},t}(r),S=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),C=function(e){function t(t){var n=e.call(this)||this;return n.controller=t,n.root=n.createElement("div",document.body,{id:"root"}),n.loginView=new c(n.controller,n.root),n.mainView=new _(n.controller,n.root),n.aboutView=new E(n.controller,n.root),n.NoConnectionView=new x(n.controller,n.root),n.mount(),n}return S(t,e),t.prototype.create=function(e,t,n){switch(e){case"login":this.loginView.create();break;case"main":this.mainView.create();break;case"about":this.aboutView.create();break;case"user-list-active":this.mainView.userList.createActiveUsers(t);break;case"user-list-inactive":this.mainView.userList.createInactiveUsers(t);break;case"user-status":this.mainView.updateUserStatus(n);break;case"user-list-messages":this.mainView.userList.showUnreadMessages(t);break;case"user-all-messages":this.mainView.showAllMessages(t);break;case"no-connection":this.NoConnectionView.create()}},t}(r),I=function(e,t,n,r){return new(n||(n=Promise))((function(s,o){function i(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))},L=function(e,t){var n,r,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(o=0)),o;)try{if(n=1,r&&(s=2&a[0]?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;switch(r=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};new(function(){function t(t){this.getSession(),this.view=new C(this),this.model=new e(this,this.view),this.router=t}return t.prototype.getSession=function(){var e=sessionStorage.getItem("funID");null===e?this.setSession(24):(this.sessionId=e,this.userName=sessionStorage.getItem("user"),this.userPassword=sessionStorage.getItem("password"))},t.prototype.setSession=function(e){var t=new Uint8Array(e);crypto.getRandomValues(t);var n=Array.from(t,(function(e){return e.toString(16).padStart(2,"0")})).join("");return sessionStorage.setItem("funID",n),n},t.prototype.redirect=function(e){globalThis.history.pushState(e,"Fun Chat","/deepcd87-JSFEEN2024Q4/fun-chat"+e),this.getView()},t.prototype.loginValidation=function(e,t){var n=document.querySelector("#login-name-message"),r=document.querySelector("#login-pwd-message"),i=document.querySelector("#login-submit-btn");if("userName"===e.name){var a=s(t);!0===a?(e.classList.remove("input__incorrect"),e.classList.add("input__correct"),n.textContent="",this.nameValidation=!0):(e.classList.remove("input__correct"),e.classList.add("input__incorrect"),n.textContent=a.toString(),this.nameValidation=!1)}if("userPwd"===e.name){var c=o(t);!0===c?(e.classList.remove("input__incorrect"),e.classList.add("input__correct"),r.textContent="",this.pwdValidation=!0):(e.classList.remove("input__correct"),e.classList.add("input__incorrect"),r.textContent=c.toString(),this.pwdValidation=!1)}this.nameValidation&&this.pwdValidation?i.removeAttribute("disabled"):i.setAttribute("disabled","")},t.prototype.loginAuth=function(e,t){return I(this,void 0,void 0,(function(){var n,r,i;return L(this,(function(a){return n=s(e),r=o(t),!0===n&&!0===r?(i={id:this.sessionId,type:"USER_LOGIN",payload:{user:{login:e,password:t}}},sessionStorage.setItem("user",e),sessionStorage.setItem("password",t),this.userName=e,this.userPassword=t,this.model.sendData(i)):console.log("LOGIN AUTHENTICATION ERROR"),[2]}))}))},t.prototype.reloginUser=function(){var e={id:this.sessionId,type:"USER_LOGIN",payload:{user:{login:this.userName,password:this.userPassword}}};this.model.sendData(e)},t.prototype.userLogout=function(){var e={id:this.sessionId,type:"USER_LOGOUT",payload:{user:{login:this.userName,password:this.userPassword}}};this.model.sendData(e)},t.prototype.getViewAuth=function(e){if(!1===e.auth)return!0;var t=sessionStorage.getItem("user");return!(!0!==e.auth||!t)},t.prototype.getActiveUsers=function(){var e={id:this.sessionId,type:"USER_ACTIVE",payload:{}};this.model.sendData(e)},t.prototype.getInactiveUsers=function(){var e={id:this.sessionId,type:"USER_INACTIVE",payload:{}};this.model.sendData(e)},t.prototype.getChat=function(e,t){var n={name:e,status:t};this.view.mainView.createChat(n),this.getAllMessages(e)},t.prototype.sendMessage=function(e,t){var n={id:this.sessionId,type:"MSG_SEND",payload:{message:{to:e,text:t}}};this.model.sendData(n)},t.prototype.editMessage=function(e,t){var n={id:this.sessionId,type:"MSG_EDIT",payload:{message:{id:e,text:t}}};this.model.sendData(n)},t.prototype.deleteMessage=function(e){var t={id:this.sessionId,type:"MSG_DELETE",payload:{message:{id:e}}};this.model.sendData(t)},t.prototype.getAllMessages=function(e){var t={id:this.sessionId,type:"MSG_FROM_USER",payload:{user:{login:e}}};this.model.sendData(t)},t.prototype.setReadStatus=function(e){var t={id:this.sessionId,type:"MSG_READ",payload:{message:{id:e}}};this.model.sendData(t)},t.prototype.getUnreadMessages=function(e){var t={id:this.sessionId,type:"MSG_FROM_USER",payload:{user:{login:e}}};this.model.sendData(t)},t.prototype.getView=function(){var e=this.router.resolve();if(!e)throw new Error("Not found");this.getViewAuth(e)?this.view.create(e.view):this.redirect("/login")},t.prototype.start=function(){return I(this,void 0,void 0,(function(){return L(this,(function(e){switch(e.label){case 0:return console.log("App is running..."),[4,this.model.createConnection()];case 1:return e.sent(),this.getView(),[2]}}))}))},t}())(new(function(){function e(e){this.registeredRoutes=e}return e.prototype.resolve=function(){this.result=void 0,this.url=globalThis.location.href,this.urlParts=this.url.split("/"),this.uri="/"+this.urlParts[5];for(var e=0;e<this.registeredRoutes.length;e+=1)if(this.uri===this.registeredRoutes[e].uri)return this.result=this.registeredRoutes[e],this.result;if(this.result)return this.result;console.log("Route not found")},e}())([{uri:"/",view:"main",auth:!0},{uri:"/login",view:"login",auth:!1},{uri:"/about",view:"about",auth:!1}])).start()})();